# ClipStudy（macOS 英语学习小工具）产品需求文档（PRD）

## 版本信息
- 文档版本：v0.2（包含“两窗口协同方案”补充）
- 最近更新：2025-11-11
- 负责人：待定

## 1. 产品概述
- 名称（暂定）：ClipStudy
- 平台：macOS（Apple Silicon 与 Intel）
- 核心价值：在阅读英文资料时，用户通过截图或剪贴板图片快速识别其中的英文内容，并以中文翻译呈现；自动按日期保存为英汉对照的知识库，便于回顾、检索和复习。
- 核心流程：截图 → OCR 识别英文 → 翻译 → 展示英汉对照 → 自动保存（按日期） → 回顾/检索/导出

## 2. 目标与非目标
- 主要目标
  - 快速将截图中的英文内容转化为可编辑文本。
  - 提供即时中文翻译（句子级和单词级）。
  - 自动按日期保存，形成英汉对照内容，便于复盘与学习。
  - 支持基本的检索与导出（Markdown/CSV）。
- 次要目标
  - 支持菜单栏快捷操作和剪贴板自动监听，提升效率。
  - 提供基础词典信息（音标、词性、例句）用于单词学习。
- 非目标（MVP阶段不做或限制）
  - 不做复杂的语法解析、写作纠错、长段落改写。
  - 不做跨平台支持（Windows/Linux）。
  - 不做多人协作与云同步（后续迭代考虑）。

## 3. 用户画像
- 学习者（大学生/自学者）：阅读英文教材/论文/网页，遇到难句或生词，想快速查义并保存。
- 职场用户：阅读英文报告、邮件、技术文档，想快速摘录并保存为知识库。
- 语言爱好者：积累词汇和短句，进行每日回顾。

## 4. 使用场景与用户旅程
- 场景 A：阅读英文 PDF/网页
  1) 用户用系统快捷键截图到剪贴板（或拖拽图片到应用）。
  2) 应用自动识别英文文本。
  3) 显示中文翻译与原文对照。
  4) 自动保存到当天的笔记条目中，可一键编辑修正。
- 场景 B：积累生词
  1) 用户截图一段文字。
  2) 应用拆分识别出词语，显示词性/音标/中文释义。
  3) 用户选择要保存的词条，自动归档到当天词汇清单。
- 场景 C：复盘与导出
  1) 用户打开主界面，按日期浏览当天条目。
  2) 通过关键字搜索过往内容。
  3) 导出为 Markdown/CSV，以便在 Notion/印象笔记中复盘。

## 5. 两窗口协同方案（新增）
- 总体架构：一个应用，两个窗口，各司其职、共享同一数据源（SQLite 和本地媒体目录）。
    - 菜单栏轻量窗口（快速捕获）
    - 常驻菜单栏图标，点击弹出轻量 Popover（默认，更轻）/Panel；弹窗尽量不抢焦点，减少打扰。
    - 支持粘贴剪贴板图片或拖拽图片 → OCR（英文） → 句子级中文翻译。
    - 默认自动保存至当天条目（含时间戳与来源图片缩略图）。
    - 操作：保存、保存并在主窗口打开、复制译文/英汉对照。
    - 可选：剪贴板监听（开关）；识别到新图片时提示快速处理。
    - 默认关闭剪贴板监听，仅手动粘贴/拖拽触发识别。
  - 主窗口（系统化管理）
    - Dock 可见的完整主窗口，支持多页面与深度操作。
    - 日期视图：按天浏览条目列表；条目卡片展示原文/译文首行与时间。
    - 条目详情：英汉对照全文，支持编辑、标注（仅标签与备注；标签支持层级；备注支持轻量 Markdown：粗体、列表；暂不提供高亮/下划线富文本）。
    - 搜索与筛选：按关键词（原文/译文/标签）检索；批量操作（导出/删除）。
    - 导出：按日或时间范围导出 Markdown/CSV；后续支持第三方集成（Notion/Obsidian）。
    - Dock 图标常驻（默认）。
- 协同机制与数据一致性
  - 数据层统一：菜单栏与主窗口共用同一数据服务（Repository/Service）。
  - 跳转打通：菜单栏保存后支持“一键在主窗口打开此条目”；主窗口提供返回菜单栏的快速入口。
  - 快捷键：全局快捷键打开菜单栏窗口；从菜单栏保存后可深链至主窗口详情（内部路由）。
  - 保存时自动镜像：保存条目后自动更新当日 Markdown 文件（镜像归档），无需手动导出。
- 错误与回退策略
  - 翻译失败时仍保存原文并标记失败状态；支持在主窗口中重试或更换引擎。
  - OCR 结果在两个窗口均可编辑，以最后一次保存为准；保留编辑历史的时间戳。

## 6. 功能需求（按优先级）
- P0（必须）
  1) 输入源：粘贴剪贴板图片、拖拽图片文件。
  2) OCR 文本识别：离线识别英文，保留基本段落结构；结果可编辑。
  3) 翻译展示：句子级翻译；单词级基础释义（词性/中文释义，音标为增强项）。
  4) 自动保存（按日期）：以系统日期归档（如 2025-11-11），保存条目包含原文、译文、时间戳、来源图片路径。
  5) 数据查看：日期视图、条目详情编辑、基本搜索。
  6) 设置（基础）：翻译引擎选择与 API Key、语言方向、隐私开关（是否调用在线翻译）。默认：允许在线翻译（需用户配置引擎），关闭剪贴板监听，语言方向为英→中。
  7) 翻译风格：默认更直译，保留英文术语（可在设置中切换风格）。
  8) 标注与标签：备注支持轻量 Markdown（粗体、列表）；标签支持层级（父子关系）。
- P1（重要增强）
  1) 菜单栏模式完善：剪贴板监听（可开关）、备用翻译引擎回退策略。
  2) 导出：CSV 与 Markdown（默认均支持）；支持批量选择与范围导出；暂不提供一键推送到第三方。
  3) 快捷键：全局快捷键打开菜单栏窗口；主窗口内快捷操作。
  4) 词典增强：音标、例句（来源可选）。
- P2（可迭代）
  1) 复习（SRS 简版）：词汇卡片与每日复习计划。
  2) 来源记录与上下文：记录来源应用名/窗口标题/文件名（可选）。
  3) 云同步与备份：iCloud/本地导入导出等。
  4) 多语言支持：英文→中文以外的组合。

## 7. 交互与界面
- 菜单栏轻量窗口（快速捕获）
  - 顶部输入区：提示“粘贴截图到此处或拖拽图片文件”。
  - 中部识别结果：原文文本框（可编辑）。
  - 下部翻译区：中文译文，支持刷新/更换引擎。
  - 底部操作：保存、保存并在主窗口打开、复制译文/英汉对照。
  - 辅助：来源图片缩略图预览；保存成功 toast（点击可跳详情）。
- 主窗口（系统化管理）
  - 左侧日期列表；右侧当天的条目卡片列表。
  - 顶部搜索栏：支持全文搜索（原文/译文/标签）。
  - 条目详情页：英汉对照全文；编辑、标注（仅标签与备注；标签支持层级；备注支持轻量 Markdown：粗体、列表）、删除、导出该条目。
  - 设置页面：翻译引擎与优先顺序（智谱优先，其次硅基流动）、各引擎 API Key 与模型选择、隐私开关、语言组合、每日 Markdown 镜像路径（通过目录选择器自定义）、数据目录与备份、快捷键。

## 8. 数据与存储设计（MVP）
- 数据结构：Entry（条目）
  - id：唯一标识
  - date：YYYY-MM-DD
  - created_at：时间戳
  - source_type：clipboard / file_drop / capture（预留）
  - source_image_path：来源图片相对路径（可选）
  - original_text：识别后的英文文本（可编辑）
  - translated_text：中文译文
  - tokens：可选，拆分出的词汇列表（词典/复习）
  - tags：可选
  - status：normal / translate_failed 等（用于状态展示）
- 存储方案
  - SQLite（推荐）：便于搜索与结构化查询；关键字段建索引。
  - 媒体文件（截图）存储在 App 数据目录，按日期分文件夹归档。
  - 每日 Markdown 文件并存（镜像归档），与 SQLite 并用，便于可读与外部复盘。
  - 每日 Markdown 路径：可在设置中自定义存储目录（默认：App 数据目录/notes/YYYY-MM-DD.md）。
- 导出格式
  - Markdown：按日期导出英汉对照，保留条目时间与来源。
  - CSV：列包含日期、时间、原文、译文、来源。

### 每日 Markdown 模板与命名
- 文件命名：`YYYY-MM-DD.md`（例如 `2025-11-11.md`）。
- 文件结构：
  - 标题：`# YYYY-MM-DD`（当天日期标题）。
  - 条目列表（按时间顺序）：每条包含：
    - 时间戳（例如 `14:23`）与来源（图片路径/来源应用名等）。
    - 原文（英文）。
    - 译文（中文）。
    - 标签（支持层级，例如 `topic/grammar`）。
    - 备注（支持轻量 Markdown：粗体、列表）。
  - 可选附录：当天统计信息（条目数量、字数等）。

## 9. 技术方案建议（不写代码）
- OCR：Apple Vision（VNRecognizeTextRequest），离线、稳定、英文识别效果好。
 - 翻译：句子级翻译默认调用智谱 AI 通用大模型（GLM）；备用引擎为硅基流动（SiliconFlow）大模型；亦支持传统机器翻译（DeepL/百度/火山）。支持多引擎轮换与失败自动回退。翻译风格默认“更严谨（偏直译），保留英文术语”，可在设置中调整。
 - 文档参考：智谱AI开放文档 https://docs.bigmodel.cn/cn/api/introduction ；SiliconFlow Chat Completions https://docs.siliconflow.cn/cn/api-reference/chat-completions/chat-completions
- 剪贴板与图片接入：NSPasteboard 读取剪贴板图片；支持拖拽文件；可选剪贴板监听。
- 应用形态：NSStatusItem + NSPopover/NSPanel（菜单栏）；NSWindow（主窗口）；Swift + AppKit。后续如需跨平台可再评估 Electron（当前不推荐）。
- 隐私与安全：
  - OCR、编辑与本地存储不上传；在线翻译仅发送必要文本。
  - 提供隐私开关与提示第三方服务条款/费用。
- 性能目标：
  - OCR：常见截图在 1 秒内完成。
  - 翻译：在线请求在 1–2 秒内返回（视网络与服务）。
  - 启动时间：≤ 2 秒。

## 10. 非功能性需求
- 易用性：粘贴即用，少步骤；界面清晰，编辑便捷。
- 稳定性：翻译服务异常不影响 OCR 与保存；提供重试与备用引擎。
- 可维护性：模块化分层（OCR、翻译、存储、UI）；日志与错误捕获。
- 可扩展性：后续增加复习、云同步、更多语言。
- 合规性：遵循 macOS 权限规范（屏幕录制/文件访问），第三方 API 合规。
 - 密钥管理：API Key 使用 macOS Keychain 安全存储；不写入配置文件或日志；调试日志对密钥与请求内容脱敏。

## 11. 成功指标（KPI）
- 单次流程耗时（从粘贴截图到展示译文）：≤ 3 秒。
- 每日条目创建数（活跃度）。
- 识别与翻译成功率（无错误保存的比例）。
- 搜索命中率与导出使用率（学习复盘行为）。
- 用户留存与满意度（问卷/反馈）。

## 12. 里程碑与范围划分
- 里程碑 1（1–2 周）：菜单栏轻量窗口 MVP
  - 粘贴/拖拽图片 → OCR → 展示原文 → 接入一个翻译引擎 → 英汉对照 → 按日期保存。
  - 基础设置（翻译引擎、隐私开关）。
- 里程碑 2（1–2 周）：主窗口基础版
  - 日期视图、条目列表与详情、编辑与标注（标签/备注）、搜索、导出。
  - 从菜单栏支持“在主窗口打开此条目”。
- 里程碑 3（2–3 周）：增强与优化
  - 词典增强（音标/例句）、批量导出与删除、剪贴板监听、翻译回退策略、性能与稳定性优化。

## 13. 风险与对策
- 翻译质量参差：支持多引擎切换与用户手动编辑，保留上下文。
- 截图复杂排版（表格/公式）：仅做文本提取，不保证版式；允许用户编辑修复。
- 网络依赖：在线翻译失败时提示并允许本地保存；支持失败重试与备用引擎。
- 法律与合规：提示用户遵守第三方 API 使用条款；提供隐私开关。
- 存储膨胀：定期清理或压缩缩略图；支持导出备份与清理策略。
- 两窗口一致性：统一数据层与状态管理，避免不一致；关键操作走服务层。

## 14. 开放问题（待你确认）
1) 菜单栏弹窗形式：Popover（更轻）还是轻量 Panel（可固定/更自由）？
2) 是否默认开启剪贴板监听（检测到图片自动提示识别）？
3) 标注能力：是以标签/备注为主，还是需要高亮/下划线等富文本标注？
4) 导出优先格式：Markdown 还是 CSV？是否需要一键推送到 Notion/Obsidian（可后续迭代）？
5) Dock 图标是否常驻，还是希望更“隐形”？
6) 翻译服务偏好：是否已有某家 API Key（如 DeepL/百度/火山），是否需要优缺点与费用对比？
7) 离线能力要求：是否需要“完全离线”（句子级翻译可能降级），还是可接受在线句子翻译？
8) 存储偏好：应用内用 SQLite 并支持导出 Markdown/CSV，是否需要每日 Markdown 文件并存？
9) 使用场景偏好：是否需要“截图后自动识别并弹窗”（剪贴板监听），还是更倾向手动粘贴以减少打扰？

## 15. 已确认的产品默认设置与选择（根据你的回复）
- 菜单栏弹窗：更轻量，默认采用 Popover，弹窗不抢焦点。
- 剪贴板监听：默认关闭，手动粘贴/拖拽触发识别。
- 标注能力：暂时仅支持“备注”和“标签”，不提供高亮/下划线等富文本标注。
- 导出：默认支持 CSV 与 Markdown 两种格式；不提供一键推送到 Notion/Obsidian。
- Dock 行为：主窗口 Dock 图标常驻。
- 翻译服务：具备智谱 API，可作为可选在线翻译引擎之一；默认允许在线翻译。
- 存储并存：除 SQLite 外，同时生成每日 Markdown 文件镜像归档。
- 使用偏好：以手动粘贴为主，减少打扰式自动弹窗。

### 新增偏好与默认策略（你最新确认）
- 句子级翻译：默认调用智谱 AI 通用大模型（GLM）；备用为硅基流动（SiliconFlow）大模型。
- 引擎优先顺序：先智谱，后硅基流动；失败自动回退。
- 翻译风格：更严谨（偏直译），保留英文术语（可在设置中切换）。
- 每日 Markdown 镜像路径：支持自定义设置（默认 App 数据目录/notes/），并在设置中通过目录选择器点选。
- Markdown 模板：包含日期标题、条目列表（原文/译文/时间/来源），以及可选的标签与备注区块。
- 标签：支持层级（父子关系）。
- 备注：支持轻量 Markdown（粗体、列表）。
- 保存行为：保存时自动镜像（自动更新当日 Markdown 文件）。

---
备注：本 PRD 已将“两窗口协同方案”纳入核心架构与里程碑规划；后续原型设计将分别输出菜单栏轻量窗口与主窗口的交互稿与关键流程图。